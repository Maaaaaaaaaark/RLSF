# IMPROVED RLSF GUI 快速开始指南

## 🎉 GUI 已成功启动！

您的 IMPROVED RLSF 训练界面现在正在运行：
- **本地地址**: http://localhost:8501
- **网络地址**: http://26.26.26.1:8501

浏览器应该已经自动打开界面。如果没有，请手动访问上述地址。

---

## 📋 快速使用流程

### 1️⃣ 快速测试（推荐首次使用）

1. **在侧边栏选择预设模板**
   - 点击"预设模板"下拉框
   - 选择 **"快速测试"**
   - 这会自动配置：
     - 训练步数: 500
     - 环境数: 2
     - 批次大小: 1024
     - WandB: 关闭

2. **点击开始训练**
   - 点击侧边栏底部的 **"▶️ 开始训练"** 按钮
   - 状态会变为 🟢 RUNNING

3. **监控训练**
   - 切换到 **"📊 概览"** 标签页查看实时指标
   - 切换到 **"📈 实时曲线"** 标签页查看训练曲线
   - 切换到 **"📝 日志"** 标签页查看详细日志

4. **等待完成**
   - 快速测试大约需要 2-5 分钟
   - 完成后状态会变为 ✅ COMPLETED

---

### 2️⃣ 自定义训练

1. **选择"自定义"模板**

2. **配置参数**（侧边栏）：
   - **环境**: SafetyPointCircle1-v0（或其他环境）
   - **训练步数**: 5000（根据需要调整）
   - **设备**: cuda（如果有 GPU）或 cpu
   - **训练环境数**: 2（Windows 建议 ≤ 4）
   - **评估环境数**: 2（Windows 建议 ≤ 4）
   - **批次大小**: 1024（建议保持）
   - **随机种子**: 0（用于复现）

3. **可选：启用 WandB**
   - 勾选"启用 WandB"
   - 输入您的 API Key（或留空使用默认）

4. **开始训练**
   - 点击 **"▶️ 开始训练"**

---

## 📊 界面功能说明

### 侧边栏（左侧）

#### 🎛️ 训练配置
- **预设模板**: 快速测试 / 短程训练 / 完整训练 / 自定义
- **基础配置**: 环境、训练步数、随机种子
- **设备配置**: CUDA/CPU 选择（自动检测 GPU）
- **并行配置**: 环境数、批次大小
- **WandB 日志**: 实验跟踪开关和 API Key
- **改进功能**: 显示已启用的改进算法

#### 🎮 训练控制
- **▶️ 开始训练**: 启动训练进程
- **⏹️ 停止训练**: 终止训练进程

---

### 主区域（右侧）

#### 📊 概览标签页
- **状态指示器**: 显示当前训练状态
  - 🔵 IDLE: 空闲
  - 🟢 RUNNING: 训练中
  - 🟡 STOPPED: 已停止
  - ✅ COMPLETED: 已完成
  - 🔴 ERROR: 错误

- **进度条**: 显示训练进度百分比

- **指标卡片**: 显示最新评估指标
  - **R (平均回报)**: 每回合的平均累计奖励
  - **C (平均代价)**: 每回合的平均累计安全代价
  - **SR (成功率)**: 代价 ≤ 阈值的回合比例
  - **V (评估值)**: (R × SR) / 10
  - **maxV (最佳值)**: 历史最佳评估值

- **改进算法指标**:
  - **δ (delta)**: 自适应偏差校正参数
  - **bias_estimate**: 偏差估计值

#### 📈 实时曲线标签页
- 四个交互式图表：
  - 平均回报曲线
  - 平均代价曲线
  - 成功率曲线
  - 评估值曲线
- 支持缩放、悬停查看数值

#### 📝 日志标签页
- 实时显示训练控制台输出
- 错误信息自动高亮（红色）
- 显示最近 200 行日志
- 自动滚动到最新日志

#### 💾 模型权重标签页
- 列出所有已保存的模型权重
- 显示每个权重的：
  - 路径
  - 文件大小
  - 文件数量
  - 最后修改时间

#### 📜 历史记录标签页
- 显示最近 10 次训练运行
- 每条记录包含：
  - 运行时间戳
  - 训练配置参数
  - 最终评估指标
- 可用于复现之前的实验

#### 🔧 系统检查标签页
- **CUDA 信息**: 显示 GPU 可用性和设备名
- **依赖包版本**: 显示关键包的版本
  - torch
  - gymnasium
  - safety-gymnasium
  - wandb
  - streamlit

---

## 🔍 指标解读

### 评估指标含义

- **R (Return) = 20.06**
  - 平均回报约为 20
  - 数值越高越好

- **C (Cost) = 649.98**
  - 平均代价约为 650
  - 数值越低越安全
  - 目标是降低到阈值以下（默认 25.0）

- **SR (Success Rate) = 0.00**
  - 成功率为 0%
  - 表示还没有回合的代价低于阈值
  - 训练初期很常见

- **V (Value) = 0.00**
  - 评估值 = (R × SR) / 10
  - 因为 SR=0，所以 V=0

- **maxV (Max Value) = 0.00**
  - 历史最佳评估值

### 训练进展判断

**初期阶段**（如您当前看到的）:
- R 较低（10-30）
- C 很高（500-1000）
- SR = 0
- 这是正常的！策略还在学习

**中期阶段**:
- R 逐渐上升（30-100）
- C 逐渐下降（100-500）
- SR 开始上升（0.1-0.5）
- 策略开始平衡回报和安全

**后期阶段**:
- R 较高（100+）
- C 降低到阈值附近（< 50）
- SR 较高（> 0.5）
- 策略已学会安全行为

---

## ⚠️ 常见问题

### Q1: 界面无法打开？
**A**: 检查终端输出，确认 Streamlit 已启动。手动访问 http://localhost:8501

### Q2: 点击"开始训练"没反应？
**A**: 
1. 检查"📝 日志"标签页是否有错误信息
2. 确保在 RLSF 目录下运行
3. 检查虚拟环境是否激活

### Q3: 训练一直显示 SR=0？
**A**: 这在训练初期是正常的。继续训练更长时间（如 5000-10000 步），C 会逐渐下降，SR 会开始上升。

### Q4: Windows 下出现 EOFError 或 AsyncVectorEnv 错误？
**A**: 
1. 降低并行环境数到 2 或 1
2. 这些错误通常不影响训练，可以忽略

### Q5: 如何停止训练？
**A**: 点击侧边栏的 **"⏹️ 停止训练"** 按钮

### Q6: 配置会保存吗？
**A**: 是的！每次点击"开始训练"时，配置会自动保存到 `.gui_config.json`，下次启动时会自动加载。

### Q7: 如何查看之前的训练？
**A**: 切换到 **"📜 历史记录"** 标签页，可以看到最近 10 次训练的配置和结果。

---

## 🚀 推荐训练流程

### 第一次使用
1. 选择 **"快速测试"** 预设（500 步）
2. 开始训练，熟悉界面
3. 观察日志和指标变化

### 初步实验
1. 选择 **"短程训练"** 预设（5000 步）
2. 尝试不同环境（SafetyPointCircle1-v0, SafetyPointGoal1-v0）
3. 观察训练曲线

### 正式训练
1. 选择 **"完整训练"** 预设（100000 步）
2. 启用 WandB 记录详细指标
3. 使用 GPU 加速（device=cuda）
4. 训练完成后查看模型权重

---

## 📁 生成的文件

GUI 会自动创建以下文件：

- **RLSF/.gui_config.json**: 用户配置（自动保存/加载）
- **RLSF/.gui_runs.json**: 训练历史记录（最多 50 条）
- **RLSF/weights/...**: 训练过程中保存的模型权重

---

## 🛠️ 命令行启动（备用）

如果双击 `start_gui.bat` 无效，可以手动运行：

```powershell
# 1. 激活虚拟环境
.\myenv\Scripts\Activate.ps1

# 2. 进入 RLSF 目录
cd RLSF

# 3. 启动 GUI
streamlit run gui_app.py
```

---

## 📞 需要帮助？

- 查看详细文档: `GUI_README.md`
- 查看算法文档: `USAGE_GUIDE.md`
- 检查系统状态: 切换到 **"🔧 系统检查"** 标签页

---

## 🎯 下一步

现在您可以：

1. ✅ **开始快速测试**: 选择"快速测试"预设，点击"开始训练"
2. 📊 **监控训练**: 切换到"概览"和"实时曲线"标签页
3. 📝 **查看日志**: 切换到"日志"标签页观察训练过程
4. 🔧 **检查系统**: 切换到"系统检查"标签页确认环境

祝您训练顺利！🚀

